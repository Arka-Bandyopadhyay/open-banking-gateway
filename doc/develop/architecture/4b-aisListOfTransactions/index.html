<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>List Of Transactions - Open Banking Gateway Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "List Of Transactions";
    var mkdocs_page_input_path = "architecture/4b-aisListOfTransactions.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Open Banking Gateway Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../roadmap/">Roadmap</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../releasenotes/">Release notes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../drafts/initial_requirements/">Initial Requirements</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Architecture</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../building_blocks/01.Application_context/">Application context</a>
                </li>
                <li class="">
                    
    <a class="" href="../building_blocks/02.Component_diagrams/">Component diagrams</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Concepts</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../concepts/psu-security-concept/">PSU Security Concept</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Use cases</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../use_cases/">Use cases</a>
                </li>
                <li class="">
                    
    <a class="" href="../1-loginWithFinTech/">Login with FinTech Application</a>
                </li>
                <li class="">
                    
    <a class="" href="../2-searchBank/">Search bank</a>
                </li>
                <li class="">
                    
    <a class="" href="../3-selectBank/">Select bank</a>
                </li>
                <li class="">
                    
    <a class="" href="../4-initiateAisConsent.md">List of Transactions</a>
                </li>
                <li class="">
                    
    <a class="" href="../5-redirectPsuToConsentAPI/">Redirect to Consent Authorization API</a>
                </li>
                <li class="">
                    
    <a class="" href="../5a-psuAuthEmbeddedConsent/">Authorize Consent Embedded Approach</a>
                </li>
                <li class="">
                    
    <a class="" href="../5b-psuAuthRedirectConsent/">Authorize Consent Redirect Approach</a>
                </li>
                <li class="">
                    
    <a class="" href="../6-consume_api/">Consume Service</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../drafts/initial_requirements/">Draft</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Open Banking Gateway Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>List Of Transactions</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/adorsys/open-banking-gateway/edit/master/docs/architecture/4b-aisListOfTransactions.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="list-of-transactions">List Of Transactions</h1>
<p>General terms defined in the <a href="../dictionary/">dictionary</a></p>
<h2 id="definition">Definition</h2>
<p>Request the list of transactions for a given bank account. </p>
<p>If there is any reference to an existing account information consent (AisConsent) stored in the database of the TPP, the TPP will use this consent reference to forward the service request to the OpenBanking interface of the ASPSP.</p>
<p>If there is no such reference in the database of the TPP, the TPP will respond the FinTech to redirect the PSU to the ConsentAuthorizationApi of the TPP.</p>
<p>In order to uniquely identify the requesting PSU, the TPP uses a unique reference made out of:
- the fintechId : the unique identifier of this FinTech in the realm of the TPP. This parameter is read from the <a href="../dictionary/#FinTechContext">FinTechContext</a> transported as jwt-Token in the Authorization header of each FinTech request to the TPP.
- the psu-id@fintech : the unique identifier of the PSU in the realm of the FinTech.  This parameter is transported in the HttpHeader named: Fintech-User-ID</p>
<h2 id="diagram">Diagram</h2>
<p><img alt="Session diagram" src="../../architecture/diagrams/useCases/4b-aisListOfTransactions.png" />  </p>
<h2 id="use-cases">Use Cases</h2>
<h3 id="lot-010-fintechuidisplaybankaccountbankaccount">LoT-010 FinTechUI.displayBankAccount(BankAccount)</h3>
<p>After receiving the list of accounts, the FinTechUI can dsiplay a single bank account to the PSU.</p>
<h3 id="lot-020-fintechuiselectservicelisttransactions">LoT-020 : FinTechUI.selectService(listTransactions)</h3>
<p>On of the services available when the FinTechUI present bank account details to the PSU is the "listOfTransactions". If selected by the PSU, the FinTechUI forwards the service call to the FinTechApi. The selection must be accompanied with some mandatory and optional service specifications. For example in the case of listOfTransactions, this the account-id is part of the request path and indicates the target account. The ListTransactionsSpec is used to describe additional optional request parameters.</p>
<h3 id="lot-030-fintechapilistoftransactions">LoT-030 : FinTechApi.listOfTransactions</h3>
<p>The FinTechUI issued a listTransactions request to the FinTechAPI with following information attached:
- <strong><a href="../dictionary/#SessionCookie">SessionCookie and X-XSRF-TOKEN</a>:</strong> The SessionCookie is used to maintain the association between PSU and FinTech. The associated X-XSRF-TOKEN is sent back and forth though the header and used to authenticate the SessionCookie.
- <strong><a href="../dictionary/#UserAgentContext">UserAgentContext</a> (invisible): </strong> describes details associated with the user agent of the PSU. Generally not visible in the description of the FinTechApi as they are automatically provided by the user agent. The purpose is to transfer context specific information on the PsuUserAgent and the request that might later be required by the ASPSP like:
  * IP-Address,
  * IP-Port,
  * Accept,
  * Accept-Charset,
  * Accept-Encoding,
  * Accept-Language,
  * Device-ID,
  * User-Agent,
  * PSU-Geo-Location,
  * Http-Method.</p>
<ul>
<li><strong>The bank-id:</strong> passed as a path parameter and references the given <a href="../dictionary/#BankProfile">BankProfile</a> that contains meta information associated with the selected Bank.</li>
<li><strong>The account-id:</strong> is sent as a path parameter and references the target bank account.</li>
<li><strong>X-Request-ID:</strong> unique identifier that identifies this request throughout the entire processing chain. Shall be contained in HTTP Response as well.</li>
<li><strong>dateFrom:</strong> Starting date (inclusive the date dateFrom) of the transaction list, mandated if no delta access is required. For booked transactions, the relevant date is the booking date. For pending transactions, the relevant date is the entry date, which may not be transparent neither in this API nor other channels of the ASPSP.</li>
<li><strong>dateTo:</strong> End date (inclusive the data dateTo) of the transaction list, default is "now" if not given. Might be ignored if a delta function is used. For booked transactions, the relevant date is the booking date. For pending transactions, the relevant date is the entry date, which may not be transparent neither in this API nor other channels of the ASPSP. </li>
<li><strong>deltaList:</strong> This data attribute indicates that the FinTech is in favour to get all transactions after the last report access for this PSU on the addressed account.  </li>
<li><strong>entryReferenceFrom:</strong> This data attribute indicates that the FinTech is in favour to get all transactions after the transaction with identification entryReferenceFrom alternatively to the above defined period. This is an implementation of a delta access. If this data element is contained, the entries "dateFrom" and "dateTo" might be ignored by the ASPSP.</li>
<li><strong>bookingStatus:</strong> To support the "pending" and "both" feature is optional for the ASPSP, Error code if not supported in the online banking frontend Default is "booked".</li>
</ul>
<h3 id="lot-040-tppbankingapilistoftransactions">LoT-040 : TppBankingApi.listOfTransactions</h3>
<p>Forwards the PSU request to TPP with following associated context informations:</p>
<ul>
<li><strong>Authorization:<a href="../dictionary/#FinTechContext">FinTechContext</a>: </strong> Contains static identification information associated with the FinTech.</li>
<li><strong>Fintech-User-ID: psu-id@fintech:</strong> the unique identifier of the PSU in the realm of the FinTech</li>
<li><strong>Service-Session-ID: UUID:</strong> a unique identifier generated by the FinTech and used to distinguish this service request from other service requests of the same type.</li>
<li><strong>Fintech-Redirect-URL-[OK|NOK]<p:auth-id,q:state>:</strong> these are URL used to redirect control to the FinTechUI application. As we set a RedirectCookie while redirecting the PSU to the ConsentAuthorizationApi of the TPP, this RedirectCookie must be transported back to the FinTechApi with the redirect call. </li>
<li>In order to distinguish redirect cookie associated with different authorization flows, we scope the Fintech-Redirect-URL with a dynamic path parameter "auth-id". This must be set in the RedirectCookie before returning it to the FinTechUI.</li>
<li>In order to protect the Fintech-Redirect-URL against XSRF with a state parameter. This state parameter is defined at initialization of the request, and added as a query parameter to the Fintech-Redirect-URL.</li>
<li><strong>Additional Parameters: </strong> like UserAgentContext, bank-id, account-id, dateFrom, dateTo, entryReferenceFrom, bookingStatus, deltaList are described in LoT-30.</li>
</ul>
<h3 id="lot-041-tppbankingapicheckauthorization">LoT-041 TppBankingApi.checkAuthorization</h3>
<p>Verifies the authenticity of the Authorization header "FinTechContext". Returns the extracted fintechId.</p>
<h3 id="lot-050-bankingprotocolfacadelistoftransactions">LoT-050 BankingProtocolFacade.listOfTransactions</h3>
<p>Forwards the call to the BankingProtocolFacade.</p>
<h3 id="lot-051-bankingprotocolfacadeselectbankingprotocol">LoT-051 BankingProtocolFacade.selectBankingProtocol</h3>
<p>TppBankingApi selects the <a href="../dictionary/#BankingProtocol">BankingProtocol</a> based on the given: ServiceSessionId or BankId and ServiceType: "listOfTransactions"</p>
<h3 id="lot-060-bankingprotocollistoftransactions">LoT-060 : BankingProtocol.listOfTransactions</h3>
<p>The <a href="../dictionary/#BankingProtocol">BankingProtocol</a> associated with the given BankProfile decides on how to proceed with the request after loading and analyzing an eventually stored TppConsentSession.</p>
<h3 id="lot-061-bankingprotocolloadmatchingconsent">LoT-061 : BankingProtocol.loadMatchingConsent</h3>
<p>ServiceSpec: loadMatchingConsent(fintechUserID, serviceSessionID, bankID, finTechId, "listOfTransactions") : TppConsentSession. If there is an existing consent reference associated with the PSU for the given service, the BankingProtocol will load the corresponding <a href="../dictionary/#TppConsentSession">TppConsentSession</a>. BankingProtocol will then use the loaded TppConsentSession to retrieve an existing consent and proceed to the ASPSP with the service request.</p>
<h3 id="lot-062-bankingprotocolstoreservicesession">LoT-062 : BankingProtocol.storeServiceSession</h3>
<p>All information associated with the service will then be stored encrypted, alongside the used consent reference if any. This routine returns a serviceSessionKey that can be used to decrypt the serviceSession.</p>
<h3 id="lot-070-no-suitable-consent-present-create-an-authorization-session">LoT-070 : No Suitable Consent Present: Create an Authorization Session</h3>
<p>If there is no suitable consent available, the BankingProtocol will update the ServiceSession with a new authorization session identified by an auth-id (in the scope of the ServiceSession) and also returning a redirectCode.
- <strong>The auth-id:</strong> is an identifier of the authorization instance in the context of this PSU. It can be a short alphanumeric string like "asrfvs" used to isolate parallel active authorization sessions from each order. This auth-id will be used by the FinTech to set the path of the corresponding RedirectSession and also used to fill the Fintech-Redirect-URL-[OK|NOK]<p:auth-id,q:state>. 
- <strong>The redirectCode:</strong> contains: the fintechID, the serviceSessionID, the serviceSessionKey and the auth-id. The redirectCode is used by the ConsentAuthorizationApi of the TPP to access the service record.</p>
<h3 id="lot-071-lot-72-lot-73-initiate-redirect">LoT-071, LoT-72, LoT-73: Initiate Redirect</h3>
<p>By throwing a redirect exception, the BankingProtocol instructs the BankingProtocolFacade, and the TppBankingApi to initiate a redirect of the PSU to the ConsentAuthorizationApi.</p>
<h3 id="lot-074-expiresessioncookiesessioncookie">LoT-074 : expireSessionCookie(SessionCookie)</h3>
<p>see <a href="../4a-aisListOfAccounts/#LoA-074">LoA-074</a></p>
<h3 id="lot-075-redirectcookie">LoT-075 : RedirectCookie</h3>
<p>See <a href="../4a-aisListOfAccounts/#LoA-075">LoA-075</a></p>
<h3 id="lot-076-fintechapi-redirects-useragent-to-the-consentauthorisationapi">LoT-076 : FinTechApi redirects userAgent to the ConsentAuthorisationApi</h3>
<p>See <a href="../4a-aisListOfAccounts/#LoA-076">LoA-076</a></p>
<h3 id="lot-080-suitable-consent-present">LoT-080 : Suitable Consent Present</h3>
<p>See <a href="../4a-aisListOfAccounts/#LoA-080">LoA-080</a></p>
<h3 id="lot-081-forward-service-request-to-aspsp">LoT-081 : Forward Service Request to ASPSP</h3>
<p>See <a href="../4a-aisListOfAccounts/#LoA-081">LoA-081</a></p>
<h4 id="lot-082-87-returned-service-response-if-sent-and-displayed-to-the-psu">LoT-082 .. -87 : Returned Service Response if sent and displayed to the PSU.</h4>
<p>The returned ListOfTransactionsResponse will travel through the call chain back to the FinTechUI and displayed to the PSU.</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/adorsys/open-banking-gateway/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
